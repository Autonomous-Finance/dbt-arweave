# Example GitHub Actions workflow for running dbt models
# Copy this file to dbt.yml and configure your secrets
#
# Required secrets:
# - DBT_PROFILES_DIR: Directory containing profiles.yml (usually ${{ github.workspace }})
# - Your database credentials (see profiles.example.yml)

name: Deploy dbt

on:
  push:
    branches: [ main ]
  schedule:
    - cron: '0 4 * * *'  # Daily at 4 AM UTC
  workflow_dispatch:

env:
  DBT_PROFILES_DIR: ${{ github.workspace }}
  DBT_SCHEMA: prod

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@main
        
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.11'
          
      - name: Install setuptools
        run: pip install --upgrade setuptools
        
      - name: Install dependencies
        run: |
          pip install dbt-core==1.7.10
          pip install dbt-clickhouse==1.7.3
          dbt deps --target dev
          
      - name: Run dbt
        run: dbt run --target prod

